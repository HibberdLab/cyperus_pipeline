Comparison of Flaveria bidentis and Flaveria robusta
========================================================

```{r}
setwd('~/hydrogen/flaveria/Fr/Fr_2')
fr <- read.csv('Fr_express.tpm', sep="\t", head=T)
key <- read.csv('key_agi.txt',sep='\t', head=F)
names(key) <- c("annotation", "description")

setwd('~/hydrogen/flaveria/Fb/Fb_2')
fb <- read.csv('Fb_express.tpm', sep="\t", head=T)

setwd('~/hydrogen/flaveria/robin')
anno <- read.csv('robin_11.txt', sep="\t", head=F)
names(anno) <- c("species", "contig", "annotation")
anno$species <- gsub(anno$species, pattern="_200", replacement="")
```

```{r fig.width=12, fig.height=12}
library(plyr)
library(reshape2)
library(ggplot2)
fr_anno <- anno[which(anno$species=="Fr"),]
fb_anno <- anno[which(anno$species=="Fb"),]

fr_2 <- merge(fr, fr_anno, by.x="contig", by.y="contig")
fr_2 <- fr_2[,-c(2, 21,22)]
fr_tpm <- ddply(fr_2, .(annotation), numcolwise(sum))        # sum columns, grouping by annotation
fr_tpm$Fr_1.1 <- fr_tpm$Fr_2.1

fb_2 <- merge(fb, fb_anno, by.x="contig", by.y="contig")
fb_2 <- fb_2[,-c(2, 21,22)]
fb_tpm <- ddply(fb_2, .(annotation), numcolwise(sum))        # sum columns, grouping by annotation
names(fb_tpm) <- gsub(names(fb_tpm), pattern="Fb_200_", replacement="Fb_")

key_fr <- fr_tpm[which(fr_tpm$annotation %in% key$annotation),]
key_fb <- fb_tpm[which(fb_tpm$annotation %in% key$annotation),]

fr_melt <- melt(key_fr)
fb_melt <- melt(key_fb)
fr_melt$variable <- gsub(fr_melt$variable, pattern="F[a-z]_[0-9].", replacement="")
fb_melt$variable <- gsub(fb_melt$variable, pattern="F[a-z]_[0-9].", replacement="")

fr_sum <- ddply(fr_melt, .(annotation,variable), numcolwise(sum))
fb_sum <- ddply(fb_melt, .(annotation,variable), numcolwise(sum))

both <- merge(fr_sum, fb_sum, by=c("annotation","variable"))
names(both) <- c("annotation","section","Fr","Fb")
both$Fb[both$Fb >2000] <- 2000
both$Fb[both$Fb <0.01] <- 0.01
both$Fr[both$Fr <0.01] <- 0.01

```

```{r scatter_plot, fig.width=12, fig.height=12}

ggplot(both, aes(x = Fr, y = Fb, group=annotation)) +
  geom_point(size = 2) +
  xlim(0,10) +
  ylim(0,10) +
  geom_path() + 
  geom_text(aes(label=section),x=both$Fr+0.2) +
  geom_text(aes(label=annotation),y=both$Fb+0.2) +
  ggtitle("Bidentis Robusta comparison of key AGIs")

```

